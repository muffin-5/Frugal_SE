<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-g">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Quiz App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover {
            transform: translateX(5px);
        }
        /* Style for selected answer */
        input[type="radio"]:checked + label {
            background-color: #2563eb; /* bg-blue-600 */
            color: white;
            border-color: #1d4ed8; /* border-blue-700 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-2xl">

    <!-- Start Screen -->
    <div id="start-screen" class="space-y-6">
        <h1 class="text-3xl font-bold text-center text-gray-800">Welcome to the Quiz!</h1>
        <p class="text-center text-gray-600">Select your category and difficulty to begin.</p>

        <!-- Category Selection -->
        <div>
            <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Category:</label>
            <select id="category" name="category" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="science">Science</option>
                <option value="history">History</option>
                <option value="tech">Technology</option>
            </select>
        </div>

        <!-- Difficulty Selection -->
        <div>
            <label for="difficulty" class="block text-sm font-medium text-gray-700 mb-2">Difficulty:</label>
            <select id="difficulty" name="difficulty" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
            </select>
        </div>

        <!-- Start Button -->
        <button id="start-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
            Start Quiz
        </button>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="hidden">
        <!-- Header: Timer and Question Count -->
        <div class="flex justify-between items-center mb-4">
            <div id="question-counter" class="text-sm font-medium text-gray-600">Question 1 / 10</div>
            <div id="timer" class="text-lg font-bold text-red-600 bg-red-100 px-3 py-1 rounded-full">
                Time: <span id="time-left">15</span>s
            </div>
        </div>

        <!-- Question -->
        <h2 id="question-text" class="text-2xl font-semibold text-gray-800 mb-6"></h2>

        <!-- Options -->
        <div id="options-container" class="space-y-4">
            <!-- Options will be dynamically inserted here -->
        </div>

        <!-- Next Button -->
        <button id="next-btn" class="w-full bg-gray-800 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-900 transition duration-300 mt-8">
            Next
        </button>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="hidden space-y-6">
        <h1 class="text-3xl font-bold text-center text-gray-800">Quiz Complete!</h1>

        <!-- Score Summary -->
        <div class="text-center p-6 bg-gray-50 rounded-lg shadow-inner">
            <h3 class="text-2xl font-semibold">Your Score: <span id="score-text" class="text-blue-600">0 / 0</span></h3>
            <div class="flex justify-center gap-6 mt-4">
                <p class="text-lg">Correct: <span id="correct-count" class="font-bold text-green-600">0</span></p>
                <p class="text-lg">Incorrect: <span id="incorrect-count" class="font-bold text-red-600">0</span></p>
            </div>
        </div>

        <!-- Charts for Analysis -->
        <div class="grid md:grid-cols-2 gap-6">
            <!-- Chart 1: Correct vs Incorrect -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-center mb-2">Answer Breakdown</h4>
                <canvas id="performance-chart"></canvas>
            </div>

            <!-- Chart 2: Time per Question -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-center mb-2">Time per Question (seconds)</h4>
                <canvas id="time-chart"></canvas>
            </div>
        </div>

        <!-- Restart Button -->
        <button id="restart-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
            Restart Quiz
        </button>
    </div>
</div>

<script>
    // --- DATABASE OF QUESTIONS ---
    const quizData = {
        science: {
            easy: [
                { question: "What is the chemical symbol for water?", options: ["H2O", "O2", "CO2", "HO"], answer: 0 },
                { question: "What planet is known as the Red Planet?", options: ["Earth", "Mars", "Jupiter", "Venus"], answer: 1 },
                { question: "What is the largest mammal?", options: ["Elephant", "Giraffe", "Blue Whale", "Hippo"], answer: 2 }
            ],
            medium: [
                { question: "What is the powerhouse of the cell?", options: ["Nucleus", "Ribosome", "Mitochondrion", "Chloroplast"], answer: 2 },
                { question: "What is the speed of light?", options: ["300,000 km/s", "150,000 km/s", "500,000 km/s", "1,000,000 km/s"], answer: 0 }
            ],
            hard: [
                { question: "What is the Heisenberg Uncertainty Principle?", options: ["Energy is conserved", "For every action, there is an equal and opposite reaction", "We cannot know both the position and speed of a particle", "The universe is expanding"], answer: 2 },
                { question: "What is the chemical formula for table salt?", options: ["NaCl", "KCl", "H2O", "C6H12O6"], answer: 0 }
            ]
        },
        history: {
            easy: [
                { question: "Who was the first President of the United States?", options: ["Thomas Jefferson", "Abraham Lincoln", "George Washington", "John Adams"], answer: 2 },
                { question: "In what year did the Titanic sink?", options: ["1905", "1912", "1918", "1923"], answer: 1 }
            ],
            medium: [
                { question: "Who discovered America?", options: ["Christopher Columbus", "Leif Erikson", "Amerigo Vespucci", "Ferdinand Magellan"], answer: 0 },
            ],
            hard: [
                 { question: "What year did World War II end?", options: ["1942", "1945", "1948", "1939"], answer: 1 }
            ]
        },
        tech: {
            easy: [
                { question: "What does 'CPU' stand for?", options: ["Central Processing Unit", "Computer Personal Unit", "Central Power Unit", "Core Processing Unit"], answer: 0 },
                { question: "What is the most popular programming language in 2023?", options: ["Java", "C++", "Python", "JavaScript"], answer: 2 }
            ],
            medium: [
                { question: "What does 'HTTP' stand for?", options: ["HyperText Transfer Protocol", "High-Level Text Protocol", "Hyperlink Transfer Protocol", "HyperText Type Protocol"], answer: 0 }
            ],
            hard: [
                { question: "Who is known as the father of the computer?", options: ["Alan Turing", "Charles Babbage", "Tim Berners-Lee", "Bill Gates"], answer: 1 }
            ]
        }
    };

    // --- DOM ELEMENTS ---
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultsScreen = document.getElementById('results-screen');

    const startButton = document.getElementById('start-btn');
    const nextButton = document.getElementById('next-btn');
    const restartButton = document.getElementById('restart-btn');

    const categorySelect = document.getElementById('category');
    const difficultySelect = document.getElementById('difficulty');

    const questionCounter = document.getElementById('question-counter');
    const timeLeftDisplay = document.getElementById('time-left');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');

    const scoreText = document.getElementById('score-text');
    const correctCount = document.getElementById('correct-count');
    const incorrectCount = document.getElementById('incorrect-count');

    // --- QUIZ STATE ---
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let timer;
    let timeLeft = 15;
    const TIME_PER_QUESTION = 15;
    let userResults = []; // To store { question, selected, correct, timeTaken }
    let performanceChart, timeChart;

    // --- EVENT LISTENERS ---
    startButton.addEventListener('click', startQuiz);
    nextButton.addEventListener('click', handleNextQuestion);
    restartButton.addEventListener('click', restartQuiz);

    // --- FUNCTIONS ---

    /**
     * Starts the quiz based on selected category and difficulty
     */
    function startQuiz() {
        const category = categorySelect.value;
        const difficulty = difficultySelect.value;

        currentQuestions = quizData[category][difficulty];
        if (!currentQuestions || currentQuestions.length === 0) {
            alert('No questions available for this selection. Please try another.');
            return;
        }

        // Reset state
        currentQuestionIndex = 0;
        score = 0;
        userResults = [];

        // Show quiz screen
        startScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');

        showQuestion();
    }

    /**
     * Displays the current question and its options
     */
    function showQuestion() {
        // Reset timer
        clearInterval(timer);
        timeLeft = TIME_PER_QUESTION;
        timeLeftDisplay.textContent = timeLeft;

        // Get current question
        const question = currentQuestions[currentQuestionIndex];

        // Update UI
        questionText.textContent = question.question;
        questionCounter.textContent = `Question ${currentQuestionIndex + 1} / ${currentQuestions.length}`;

        // Clear old options
        optionsContainer.innerHTML = '';

        // Create and append new options
        question.options.forEach((option, index) => {
            const optionId = `option-${index}`;
            const optionElement = document.createElement('div');
            optionElement.classList.add('quiz-option');

            optionElement.innerHTML = `
                <input type="radio" name="option" id="${optionId}" value="${index}" class="hidden">
                <label for="${optionId}" class="option-label block w-full p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100">
                    ${option}
                </label>
            `;
            optionsContainer.appendChild(optionElement);
        });

        // Update button text
        if (currentQuestionIndex === currentQuestions.length - 1) {
            nextButton.textContent = 'Submit';
        } else {
            nextButton.textContent = 'Next';
        }

        // Start the timer
        startTimer();
    }

    /**
     * Starts the countdown timer for the current question
     */
    function startTimer() {
        timer = setInterval(() => {
            timeLeft--;
            timeLeftDisplay.textContent = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(timer);
                handleNextQuestion(); // Auto-submit when time is up
            }
        }, 1000);
    }

    /**
     * Handles the logic for moving to the next question or finishing the quiz
     */
    function handleNextQuestion() {
        clearInterval(timer); // Stop the timer

        const timeTaken = TIME_PER_QUESTION - timeLeft;
        const selectedOption = document.querySelector('input[name="option"]:checked');
        const selectedAnswer = selectedOption ? parseInt(selectedOption.value) : -1; // -1 if no answer
        const correctAnswer = currentQuestions[currentQuestionIndex].answer;

        // Check answer and update score
        if (selectedAnswer === correctAnswer) {
            score++;
        }

        // Store result for analysis
        userResults.push({
            question: currentQuestions[currentQuestionIndex].question,
            selected: selectedAnswer,
            correct: correctAnswer,
            timeTaken: timeTaken
        });

        // Move to the next question or show results
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
            showQuestion();
        } else {
            showResults();
        }
    }

    /**
     * Displays the final results and analysis charts
     */
    function showResults() {
        // Show results screen
        quizScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        const totalQuestions = currentQuestions.length;
        const correctAnswers = score;
        const incorrectAnswers = totalQuestions - score;

        // Update score text
        scoreText.textContent = `${correctAnswers} / ${totalQuestions}`;
        correctCount.textContent = correctAnswers;
        incorrectCount.textContent = incorrectAnswers;

        // Render charts
        renderCharts(correctAnswers, incorrectAnswers);
    }

    /**
     * Renders the analysis charts using Chart.js
     */
    function renderCharts(correctAnswers, incorrectAnswers) {
        // Destroy existing charts if they exist
        if (performanceChart) {
            performanceChart.destroy();
        }
        if (timeChart) {
            timeChart.destroy();
        }

        // 1. Performance Doughnut Chart
        const performanceCtx = document.getElementById('performance-chart').getContext('2d');
        performanceChart = new Chart(performanceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Correct', 'Incorrect'],
                datasets: [{
                    data: [correctAnswers, incorrectAnswers],
                    backgroundColor: ['#16a34a', '#dc2626'], // Green-600, Red-600
                    hoverBackgroundColor: ['#15803d', '#b91c1c']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        // 2. Time per Question Bar Chart
        const timeCtx = document.getElementById('time-chart').getContext('2d');
        const questionLabels = userResults.map((_, index) => `Q${index + 1}`);
        const timeData = userResults.map(result => result.timeTaken);

        timeChart = new Chart(timeCtx, {
            type: 'bar',
            data: {
                labels: questionLabels,
                datasets: [{
                    label: 'Time Taken (s)',
                    data: timeData,
                    backgroundColor: '#2563eb' // Blue-600
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: TIME_PER_QUESTION
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    /**
     * Resets the quiz and returns to the start screen
     */
    function restartQuiz() {
        // Destroy charts
        if (performanceChart) performanceChart.destroy();
        if (timeChart) timeChart.destroy();

        // Show start screen
        resultsScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
    }

</script>
</body>
</html>